# PgPostalCodeSync 要件定義書

## 概要

日本郵便の住所の郵便番号（UTF-8形式）を毎月定期的に取り込み、PostgreSQLデータベースに保持するコンソールアプリケーション。

## ユーザストーリー

### ストーリー1: 月次差分データ取り込み

- **である** システム管理者 **として**
- **私は** 郵便番号データを月初に前月分だけ取り込みたい **をしたい**
- **そうすることで** 最新の郵便番号情報を保持できる

### ストーリー2: 初期データ全件取り込み

- **である** システム管理者 **として**  
- **私は** データベースが空の場合に全件データを取り込みたい **をしたい**
- **そうすることで** システム初期化を完了できる

### ストーリー3: 強制フル更新

- **である** システム管理者 **として**
- **私は** 任意のタイミングで全件データを再取り込みしたい **をしたい**
- **そうすることで** データ復旧を実行できる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは月初に前月分の差分データ（追加・削除）を取り込まなければならない
- REQ-002: システムはデータベースにデータが存在しない場合、全件データを取り込まなければならない
- REQ-003: システムは日本郵便サイトからUTF-8形式のZIPファイルをダウンロードしなければならない
- REQ-004: システムはZIPファイルを解凍してCSVデータをPostgreSQLに投入しなければならない

### 条件付き要件

- REQ-101: --fullオプションが指定された場合、システムは全件取り込みを実行しなければならない
- REQ-102: --yymmオプションが指定された場合、システムは指定年月の差分データを取り込まなければならない
- REQ-103: フル取り込み時、システムは新テーブル作成→リネームで瞬時切替しなければならない

### 制約要件

- REQ-401: システムは.NET 9 / PostgreSQLで動作しなければならない
- REQ-402: システムはWindows/Linuxで動作しなければならない

## 受け入れ基準

### 機能テスト

- [ ] 月初実行時に前月分の差分データが取り込まれる
- [ ] 空のデータベースに全件データが取り込まれる  
- [ ] --fullオプションで強制フル取り込みが実行される
- [ ] --yymmオプションで指定年月のデータが取り込まれる
- [ ] フル取り込み時にテーブルリネーム切替が行われる